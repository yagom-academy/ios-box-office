# ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ğŸ“¦
> ì˜í™”ì§„í¥ìœ„ì›íšŒì˜ ì¼ë³„ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ë° ì˜í™” ìƒì„¸ì •ë³´ API ë¬¸ì„œì— ìˆëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ 
> `ì˜¤ëŠ˜ì˜ ì¼ì¼ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ì¡°íšŒ` ë° `ì˜í™” ê°œë³„ ìƒì„¸ ì¡°íšŒ`ë¥¼ ì¶œë ¥í•˜ëŠ” ì•± 


> í”„ë¡œì íŠ¸ ê¸°ê°„: 2023.03.20-2023.03.31

## ëª©ì°¨

1. [íŒ€ì›](#íŒ€ì›)
2. [íƒ€ì„ë¼ì¸](#íƒ€ì„ë¼ì¸)
3. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
4. [ì°¸ê³ ë§í¬](#ì°¸ê³ ë§í¬)


## íŒ€ì›

| Sehong   |
| :-----------: |
| <img height="210px" src="https://i.imgur.com/64dvDJl.jpg"> 
|[Github Profile](https://github.com/sehoong0429)

## íƒ€ì„ë¼ì¸

### step1 

| ë‚ ì§œ          | ì£¼ìš” ì§„í–‰ ì‚¬í•­                                             |
| ------------- | ----------------------------------------------------- |
| 03.20     | Json ë°ì´í„°ì™€ ë§¤ì¹­í•  ì¼ë³„ ë°•ìŠ¤ì˜¤í”¼ìŠ¤API ë°ì´í„° ëª¨ë¸ íƒ€ì… êµ¬í˜„ |
| 03.20     | Json í…ŒìŠ¤íŠ¸ì¼€ì´ìŠ¤ êµ¬í˜„ | 

### step2, step2-1 

| ë‚ ì§œ          | ì£¼ìš” ì§„í–‰ ì‚¬í•­                                             |
| ------------- | ----------------------------------------------------- |
| 03.22     | NetworkError íƒ€ì… êµ¬í˜„                          |
| 03.22     | ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ìˆ˜í–‰í•˜ëŠ” APIProvider í´ë˜ìŠ¤ êµ¬í˜„                 |
| 03.22     | Jsonë°ì´í„° ë””ì½”ë”© ìˆ˜í–‰ ì‘ì—…í•  JSONConverter í´ë˜ìŠ¤ êµ¬í˜„ |
| 03.22     | ì˜í™” ê°œë³„ ìƒì„¸ì¡°íšŒë¥¼ ìœ„í•œ ë°ì´í„° ëª¨ë¸ êµ¬í˜„         |
| 03.22     | ì˜í™” ì •ë³´ APIì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°ì¢… ì •ë³´ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” MovieAPI êµ¬í˜„ |
| 03.22     | API ìš”ì²­ì„ ë°›ì•„ í•´ë‹¹ ìš”ì²­ë°›ê³  í•´ë‹¹ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” performRequest í•¨ìˆ˜ êµ¬í˜„ |
| 03.22     | ì¼ì¼ì˜¤í”¼ìŠ¤ ë° ì˜í™” ìƒì„¸ ë°ì´í„° ì¶œë ¥ì„ ìœ„í•œ í•¨ìˆ˜ êµ¬í˜„ |                       |
| 03.23     | í…ŒìŠ¤íŠ¸í™˜ê²½ì—ì„œ ì‚¬ìš©í•  URLSessionDataTask ëŒ€ì²´ í”„ë¡œí† ì½œ êµ¬í˜„ |
| 03.23     | íŒŒë¼ë¯¸í„° ì •ë ¬ì„ ìœ„í•œ URL Extension ì¶”ê°€                 |
| 03.23     | URLSessionDataTaskë¥¼ ëª¨ë°©í•˜ì—¬ ë™ì‘í•˜ëŠ” í´ë˜ìŠ¤ êµ¬í˜„   |
| 03.23     | APIProvider ë©”ì„œë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ MockURLSession í´ë˜ìŠ¤ êµ¬í˜„ | 

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ… 

### 1ï¸âƒ£ API TEST 

1. í…ŒìŠ¤íŠ¸ ì§„í–‰ì‹œ URLì´ ì„ì˜ë¡œ ì§€ì •ë˜ì–´ë„ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼ë˜ëŠ” ë¬¸ì œ
2. URL íŒŒë¼ë¯¸í„° ì¿¼ë¦¬ì˜ ìœ„ì¹˜ê°€ ë³€ê²½ë˜ì–´ ì†ì„±ì´ ê°™ì•„ë„ ê°™ì€ URLë¡œ ì¸ì‹í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ë¬¸ì œ


í•´ë‹¹ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ê°ê° ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” URLì„ ë„£ê³  ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ëŠ” í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. 
í•˜ì§€ë§Œ í•´ë‹¹ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” URLì€ ë„˜ê¸°ê³  ì„œë²„ì—ëŸ¬ë¥¼ ë§Œë“¤ì–´ì£¼ê³  ìˆìŠµë‹ˆë‹¤.  
![](https://i.imgur.com/44HNwk7.png)


boxOfficeURLStringì„ ì„ì˜ë¡œ ì§€ì •í•´ë„ í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•œë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![](https://i.imgur.com/KElJwAW.png)

ì´ë¥¼ ìœ„í•´, URL extensionì— normalizedURL ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì •ë ¬í•˜ì—¬ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
```swift
extension URL {
    var normalizedURL: URL? {
        guard var components = URLComponents(url: self, resolvingAgainstBaseURL: false) else {
            return nil
        }
        
        if let queryItems = components.queryItems {
            components.queryItems = queryItems.sorted { $0.name < $1.name }
        }
        
        return components.url
    }
}


```
MockURLSessionì—ì„œëŠ” ìš”ì²­ URLê³¼ ì‘ë‹µURLì„ ë¹„êµí•˜ì—¬ ë‹¤ë¥´ë‹¤ë©´,
URLError.differentURL ì—ëŸ¬ë¥¼ ë°˜í™˜í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ì—¬ ìœ„ ë‘ê°€ì§€ ë¬¸ì œë¥¼ í•´ê²°í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. 

```swift
if request.url?.normalizedURL != self.response.urlResponse?.url?.normalizedURL {
                self.response.error = URLError.differentURL
}
```



## 2ï¸âƒ£ HTTP ìƒíƒœì½”ë“œì— ë”°ë¥¸ ì—ëŸ¬ì²˜ë¦¬ 

APIProviderí´ë˜ìŠ¤ ë‚´ì˜ dataTask í•¨ìˆ˜ëŠ” URLSessionì˜ dataTaskë¥¼ ì‹¤í–‰í•˜ì—¬
ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ìˆ˜í–‰í•˜ê³  ê²°ê³¼ë¥¼ completionHandlerì— ì „ë‹¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

ë˜í•œ í•¨ìˆ˜ ë‚´ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬, ì„œë²„ ì—ëŸ¬ ë“±ì˜ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.  
í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì €ëŠ” Http ìƒíƒœì½”ë“œì— ë”°ë¥¸ ì—ëŸ¬ì²˜ë¦¬ë¥¼ 200~299 ì„±ê³µ ìƒíƒœ ì½”ë“œê°€ ì•„ë‹ˆë©´ 
ëª¨ë‘ `serverError` ê²½ìš°ë¡œ ë‹¨ í•œê°€ì§€ë¡œë§Œ ì²˜ë¦¬í•´ì£¼ê³  ìˆì—ˆìŠµë‹ˆë‹¤. 

```swift
 private func dataTask(request: URLRequest, completionHandler: @escaping (Result<Data, NetworkError>) -> Void) {
        
            ....

        guard let response = urlResponse as? HTTPURLResponse, (200...299).contains(response.statusCode) else {
            completionHandler(.failure(.serverError))
            return
        }      
            
        ...
                                                   
    }
```

Http ìƒíƒœì½”ë“œëŠ” ê°„ë‹¨íˆ ì•„ë˜ì™€ ê°™ì´ ë¶„ë¥˜ë©ë‹ˆë‹¤.

100 - 199 : ì •ë³´ì„± ìƒíƒœ ì½”ë“œ
200 - 299 : ì„±ê³µ ìƒíƒœ ì½”ë“œ
300 - 399 : ë¦¬ë‹¤ì´ë ‰ì…˜ ìƒíƒœ ì½”ë“œ
400 - 499 : í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬ ìƒíƒœ ì½”ë“œ
500 - 599 : ì„œë²„ ì—ëŸ¬ ìƒíƒœ ì½”ë“œ


ìœ„ì˜ ìƒíƒœì½”ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ê²°ê³¼ì— ë”°ë¼ ì„±ê³µìƒíƒœì— ë°ì´í„°ë¥¼ ë°›ê³  ë‚˜ë¨¸ì§€ì˜ ê²½ìš° ê°ê° ë‹¤ë¥¸ ì—ëŸ¬ì²˜ë¦¬ë¥¼ í•´ì£¼ëŠ” ë°©í–¥ìœ¼ë¡œ ë¡œì§ì„ ìˆ˜ì •í•´ë³´ì•˜ìŠµë‹ˆë‹¤. 
```swift
        
guard let response = urlResponse as? HTTPURLResponse else {
    completionHandler(.failure(.invalidURLRequest))
        return
        }
        
    switch response.statusCode {
        case 200...299:
        if let data = data {
            completionHandler(.success(data))
        } else {
            completionHandler(.failure(.missingData))
        }
        case 400...499:
            completionHandler(.failure(.clientError))
        case 500...599:
            completionHandler(.failure(.serverError))
        default:
            completionHandler(.failure(.invalidURLComponents))
        }
    }
    task.resume()
}

```

### 3ï¸âƒ£Â API ê´€ë¦¬ë¥¼ ìœ„í•œ MovieAPI 

Step2ì—ì„œëŠ” ì˜¤ëŠ˜ì˜ ì¼ì¼ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ì¡°íšŒ, ì˜í™” ê°œë³„ ìƒì„¸ì¡°íšŒì— ëŒ€í•œ ë„¤íŠ¸ì›Œí‚¹ íƒ€ì…ì„ êµ¬í˜„í•´ì•¼í•©ë‹ˆë‹¤.
ê° API ìš”ì²­ì— ëŒ€í•œ í•„ìš”í•œ ì •ë³´ë¥¼ ì „ë‹¬ í•  ìˆ˜ ìˆë„ë¡ ì—°ê´€ ê°’ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.

 

1. boxOffice: ì¼ì¼ ë°•ìŠ¤ì˜¤í”¼ìŠ¤ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” API
    - targetDt(date)ê°€ í•„ìš”í•©ë‹ˆë‹¤.
2. detail: íŠ¹ì • ì˜í™”ì˜ ìƒì„¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” API
    - movieCd(code)ê°€ í•„ìš”í•©ë‹ˆë‹¤.

extensionìœ¼ë¡œ API ìš”ì²­ì— ëŒ€í•œ ê²½ë¡œ, ë©”ì†Œë“œ, íŒŒë¼ë¯¸í„°ë¡œ ê° API ì†ì„±ì„ ë‚˜ëˆ ì„œ ê´€ë¦¬í•´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤. 

1. ê° ì†ì„±ì„ ë³„ë„ë¡œ ê´€ë¦¬í•˜ë©´ í•„ìš”í•œ ë¶€ë¶„ë§Œ ê°€ì ¸ì™€ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ë™ì¼í•œ baseURL, methodë¥¼ ë‹¤ë¥¸ APIê°€ ì¶”ê°€ ë  ê²½ìš°ì—ë„ ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
2. APIì˜ ì†ì„±ë“¤ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì—¬ ê´€ë¦¬í•˜ë©´ ì½”ë“œê°€ êµ¬ì¡°í™”ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
3. ê° ì†ì„±ì„ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•˜ë©´, APIë¥¼ í™•ì¥í•˜ê±°ë‚˜ ìˆ˜ì •í•  ë•Œ ì‰½ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```swift
extension MovieAPI {
    
    var key: String {
      return "5946533a51615e4910d26ed447f2a666"
    }
    
    var baseURL: String {
        return "http://kobis.or.kr"
    }
    
    var path: String {
        switch self {
        case .boxOffice:
            return "/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json"
        case .detail:
            return "/kobisopenapi/webservice/rest/movie/searchMovieInfo.json"
        }
    }
    
    ... 
    
}
```

### 4ï¸âƒ£ ì—ëŸ¬íƒ€ì…
ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì²˜ë¦¬ ì¤‘ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì—ëŸ¬ë“¤ì„ ì´ 4ê°€ì§€ë¡œ ë‚˜íƒ€ë‚´ì£¼ì—ˆìŠµë‹ˆë‹¤.
ë˜í•œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ ì œê³µí•  ìˆ˜ ìˆëŠ” LocalizedError ë¥¼ ì±„íƒí•´ë³´ì•˜ìŠµë‹ˆë‹¤.

`clientError` - í´ë¼ì´ì–¸íŠ¸ê°€ ì˜ëª»ëœ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê±°ë‚˜ ìš”ì²­ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì€ ê²½ìš°
`serverError` - ì„œë²„ê°€ ë‚´ë¶€ ì˜¤ë¥˜ë¡œ ì¸í•´ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ì—†ê±°ë‚˜ ì„œë²„ê°€ ì˜¬ë°”ë¥¸ ì‘ë‹µì„ ì œê³µí•˜ì§€ ëª»í•œ ê²½ìš°
`invalidURLComponents` - API ìš”ì²­ì„ êµ¬ì„±í•˜ëŠ” ë° í•„ìš”í•œ URL êµ¬ì„± ìš”ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•Šì€ í˜•ì‹ì¸ ê²½ìš°
`invalidURLRequest` - ìš”ì²­ URLì´ ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë˜ì§€ ì•Šì€ ê²½ìš°
`missingData` - ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°

```swift
enum NetworkError: LocalizedError, CustomStringConvertible {
    case clientError
    case serverError
    case invalidURLComponents
    case invalidURLRequest
		case missingData 
    
    var description: String {
        switch self {
        case .clientError:
            return "CLINET_ERROR"
        case .serverError:
            return "SERVER_ERRROR"
        case .invalidURLComponents:
            return "INVALID_URL_COMPONENTS"
        case .invalidURLRequest:
            return "INVALID_URL_REQUEST"
				case .missingData:
            return "MISSING_DATA"
        }
    }
}
```

## ì°¸ê³ ë§í¬ 

- [URLSession](https://developer.apple.com/documentation/foundation/urlsession)
[Fetching Website Data into Memory](https://developer.apple.com/documentation/foundation/url_loading_system/fetching_website_data_into_memory)
- [swiftì—ì„œ Json Parsingí•˜ê¸°](https://learn-hyeoni.tistory.com/m/45)
- [swiftì—ì„œ codableì‚¬ìš©í•˜ê¸°](https://medium.com/humanscape-tech/swiftì—ì„œ-codable-ì‚¬ìš©í•˜ê¸°-367587c5a591)
- [restful-apiëŠ” ë¬´ì—‡ì¼ê¹Œìš”?](https://aws.amazon.com/ko/what-is/restful-api/)
- [restAPIì œëŒ€ë¡œì•Œê³ ì‚¬ìš©í•˜ê¸°](https://meetup.nhncloud.com/posts/92)
- [ë„¤íŠ¸ì›Œí¬ì™€ ë¬´ê´€í•œURLSessionTest](https://wody.tistory.com/10)
- [ë„¤íŠ¸ì›Œí¬ í†µì‹ (RESTful API, JSON, URLSession)](https://weekoding.tistory.com/m/7)
- [JSON APIì™€ ë„¤íŠ¸ì›Œí¬ í†µì‹ í•˜ê¸° - URLSession, JSONConverter](https://bibi6666667.tistory.com/m/359)
- [Test Doubleì´ë€](https://jiseobkim.github.io/swift/2022/02/06/Swift-Test-Double(%EB%B6%80%EC%A0%9C-Mock-&-Stub-&-SPY-%EC%9D%B4%EB%9F%B0%EA%B2%8C-%EB%AD%90%EC%A7%80-).html)
- [http í†µì‹  get , post , post body json ìš”ì²­ ì‹¤ì‹œ](https://kkh0977.tistory.com/1334)
- [JsoníŒŒì¼ë§Œë“¤ê¸°](https://jurgen-94.tistory.com/30)
- [Constructing URLs in Swift](https://www.swiftbysundell.com/articles/constructing-urls-in-swift/)
- [iOS Networking and Testing](https://techblog.woowahan.com/2704/)
- [[Swift] Mock ì„ ì´ìš©í•œ Network Unit Test í•˜ê¸°](https://sujinnaljin.medium.com/swift-mock-ì„-ì´ìš©í•œ-network-unit-test-í•˜ê¸°-a69570defb41)
- [HTTPSìƒíƒœì½”ë“œ](https://dev-mystory.tistory.com/274)
